#!/usr/bin/env node
/**
 * Write app version from package.json to src/generated/app-version.ts
 * so dev and build both show the same version (no reliance on Vite define in dev).
 * Runs via predev and prebuild.
 */
const { readFileSync, writeFileSync, mkdirSync } = require('fs')
const path = require('path')

const root = path.join(__dirname, '..')
const pkgPath = path.join(root, 'package.json')
const outDir = path.join(root, 'src', 'generated')
const outPath = path.join(outDir, 'app-version.ts')

const pkg = JSON.parse(readFileSync(pkgPath, 'utf-8'))
const version = pkg.version || '0.0.0'

mkdirSync(outDir, { recursive: true })
writeFileSync(
  outPath,
  `// Generated by scripts/write-app-version.cjs - do not edit
export const APP_VERSION = ${JSON.stringify(version)};
`,
  'utf-8'
)
console.log('App version:', version)
